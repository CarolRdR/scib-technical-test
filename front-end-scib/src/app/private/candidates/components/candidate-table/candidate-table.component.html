<mat-card class="candidate-table-card">

  <div class="table-body">
    <app-search-bar
      [label]="'CANDIDATE_TABLE.SEARCH' | translate"
      [placeholder]="'CANDIDATE_TABLE.SEARCH' | translate"
      [value]="searchTerm"
      [clearButtonAriaLabel]="'CANDIDATE_TABLE.CLEAR_SEARCH' | translate"
      (valueChange)="applyFilter($event)"
      (clear)="clearSearch()"
    />
    @if (isLoading()) {
    <div class="loading-spinner">
      <mat-progress-spinner
        diameter="32"
        mode="indeterminate"
        role="status"
        [attr.aria-label]="'CANDIDATE_TABLE.LOADING' | translate"
      ></mat-progress-spinner>
    </div>
    }
    @if (hasCandidates()) {
      <div class="candidate-table-wrapper">
        <table
          mat-table
          [dataSource]="dataRows()"
          matSort
          (matSortChange)="onSortChange($event)"
          class="candidate-table"
          aria-label="Candidate list"
        >
          <ng-container matColumnDef="name" sticky>
            <th mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Sort by name">{{ 'CANDIDATE_TABLE.COLUMNS.NAME' | translate }}</th>
            <td mat-cell *matCellDef="let candidate">{{ candidate.name | titlecase }}</td>
          </ng-container>

          <ng-container matColumnDef="surname">
            <th mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Sort by surname">{{ 'CANDIDATE_TABLE.COLUMNS.SURNAME' | translate }}</th>
            <td mat-cell *matCellDef="let candidate">{{ candidate.surname | titlecase }}</td>
          </ng-container>

          <ng-container matColumnDef="seniority">
            <th mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Sort by seniority">{{ 'CANDIDATE_TABLE.COLUMNS.SENIORITY' | translate }}</th>
            <td mat-cell *matCellDef="let candidate">{{ candidate.seniority | titlecase }}</td>
          </ng-container>

          <ng-container matColumnDef="years">
            <th mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Sort by years">{{ 'CANDIDATE_TABLE.COLUMNS.YEARS' | translate }}</th>
            <td mat-cell *matCellDef="let candidate">{{ candidate.years }}</td>
          </ng-container>

          <ng-container matColumnDef="availability">
            <th mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Sort by availability">
              {{ 'CANDIDATE_TABLE.COLUMNS.AVAILABILITY' | translate }}
            </th>
            <td mat-cell *matCellDef="let candidate">
              <mat-chip-set aria-label="Availability status">
                <mat-chip
                  class="availability-chip"
                  [ngClass]="
                    candidate.availability
                      ? 'availability-chip--available'
                      : 'availability-chip--unavailable'
                  "
                  [removable]="false"
                  disableRipple
                >
                  {{
                    candidate.availability
                      ? ('CANDIDATE_TABLE.AVAILABILITY.TRUE' | translate)
                      : ('CANDIDATE_TABLE.AVAILABILITY.FALSE' | translate)
                  }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    } @else {
      <div class="empty-state" aria-live="polite">
        @if (isLoading()) {
          <p>{{ 'CANDIDATE_TABLE.LOADING' | translate }}</p>
        } @else {
          <p>{{ 'CANDIDATE_TABLE.EMPTY' | translate }}</p>
        }
      </div>
    }
  </div>
</mat-card>
